<template>

    <!-- HEADER -->
    <header class="top-bar">
        <h1>üè° PropertyMind</h1>

        <div class="top-actions">
            <button onclick={toggleTheme} class="icon-btn">
                {themeIcon}
            </button>

            <button class="icon-btn" onclick={toggleFavoritesDrawer}>
                ‚ù§Ô∏è {favorites.length}
            </button>
        </div>
    </header>

    <!-- HERO SEARCH -->
    <section class="hero">
        <h2>Discover Homes You‚Äôll Love</h2>
        <p>Smart search ‚Ä¢ Real insights ‚Ä¢ Better decisions</p>

        <div class="search-card">
            <lightning-combobox
                label="Property Type"
                value={propertyType}
                options={propertyTypeOptions}
                onchange={handlePropertyTypeChange}>
            </lightning-combobox>

            <lightning-input
                label="Location"
                type="text"
                data-id="location"
                value={location}
                onchange={handleLocationChange}
                required>
            </lightning-input>

            <lightning-button
                label="Search"
                variant="brand"
                onclick={handleSearch}>
            </lightning-button>
        </div>
    </section>

    <!-- SKELETON -->
    <template if:true={isLoading}>
        <div class="grid">
            <div class="skeleton" for:each={skeletons} for:item="s" key={s}></div>
        </div>
    </template>

    <!-- PROPERTY GRID -->
    <section class="grid" if:false={isLoading}>
        <template for:each={displayedProperties} for:item="property">
            <article key={property.propertyData.Id}
                     class="card"
                     data-id={property.propertyData.Id}
                     onclick={navigateToPropertyDetail}>

                <img src={property.ImageUrl}
                     data-id={property.propertyData.Id}
                     onerror={handleImageError} />

                <span class="price">‚Çπ{property.propertyData.Price__c}</span>

                <button class="fav"
                        data-id={property.propertyData.Id}
                        onclick={toggleFavorite}>
                    ‚ù§Ô∏è
                </button>

                <div class="content">
                    <h3>{property.propertyData.Name}</h3>
                    <p>{property.propertyData.Address__c}</p>

                    <div class="meta">
                        <span>{property.Bedrooms}</span>
                        <span>{property.propertyData.Property_Type__c}</span>
                        <span class="ai">AI: Fair Price</span>
                    </div>

                    <div class="actions">
                        <lightning-button
                            label="Interest"
                            data-id={property.propertyData.Id}
                            onclick={handleExpressInterest}>
                        </lightning-button>

                        <input type="checkbox"
                               data-id={property.propertyData.Id}
                               onchange={toggleCompare} />
                        Compare
                    </div>
                </div>
            </article>
        </template>
    </section>

    <!-- EMPTY STATE -->
    <template if:true={noResultsMessage}>
        <div class="empty">
            <h3>No homes found</h3>
            <p>{noResultsMessage}</p>
            <blockquote>
                ‚ÄúThe best investment on Earth is Earth.‚Äù
            </blockquote>
        </div>
    </template>

    <!-- COMPARE BAR -->
    <template if:true={compareList.length}>
        <div class="compare-bar">
            <span>{compareList.length} selected</span>
            <lightning-button label="Compare Now"></lightning-button>
        </div>
    </template>

</template>
